<!DOCTYPE html>
<html>
<head>
    <title>SignalR Test</title>
    <script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
</head>
<body>
    <h3>SignalR WebSocket Test</h3>
    <div id="messages"></div>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5002/hubs/market-data")
            .build();

        const messages = document.getElementById("messages");

        function addMessage(message) {
            const div = document.createElement("div");
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            messages.appendChild(div);
        }

        connection.onclose(() => addMessage("Connection closed"));
        connection.onreconnecting(() => addMessage("Reconnecting..."));
        connection.onreconnected(() => addMessage("Reconnected"));

        // Listen for PriceUpdate events
        connection.on("PriceUpdate", function (data) {
            addMessage(`PriceUpdate received: ${JSON.stringify(data)}`);
        });

        connection.start()
            .then(() => {
                addMessage("Connected to SignalR hub");

                // Wait for messages for 10 seconds
                setTimeout(() => {
                    addMessage("Test completed after 10 seconds");
                    connection.stop();
                }, 10000);
            })
            .catch(err => addMessage(`Connection failed: ${err.toString()}`));
    </script>
</body>
</html>
